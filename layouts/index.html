{{ define "main" }}

{{ $config := .Site.Data.config }}
{{ $homepage := $config.homepage }}
 
<!-- Hero animÃ© (conservÃ© tel quel car spÃ©cifique) -->
{{ partial "hero.html" . }}

<!-- SECTION MIGRÃ‰E : DerniÃ¨res recettes -->
<section class="section">
  <div class="container">
    
    <!-- ðŸ·ï¸ Titre avec classe section__title -->
    <h2 class="section__title">
      {{ $homepage.latest_recipes.title }}
    </h2>
    
    <!-- Description -->
    <p class="text-base text-center mb-8 max-w-2xl mx-auto" style="color: var(--color-text-secondary);">
      {{ $homepage.latest_recipes.description }}
    </p>

    <!-- Grille recettes avec CARTES PREMIUM -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {{ range first 6 (where .Site.RegularPages "Section" "recipes") }}
        
        <!-- ðŸ† CARTE PREMIUM STYLÃ‰E -->
        <a href="{{ .RelPermalink }}" class="group block bg-white overflow-hidden hover:shadow-xl transition-shadow duration-300 rounded-lg">
          
<!-- Image optimisÃ©e -->
          <div class="relative overflow-hidden aspect-[4/3]">
            {{ with .Params.image }}
              {{ $img := resources.Get (printf "images/%s" .) }}
              {{ if $img }}
                {{ $webp := $img.Fill "400x300 q50 webp" }}
                {{ $fallback := $img.Fill "400x300 q60" }}
                
                <picture>
                  <source srcset="{{ $webp.RelPermalink }}" type="image/webp">
                  <img src="{{ $fallback.RelPermalink }}" 
                       alt="{{ $.Title }}" 
                       class="w-full h-full object-cover"
                       loading="lazy"
                       width="400" 
                       height="300">
                </picture>
              {{ else }}
                <img src="/{{ . }}" 
                     alt="{{ $.Title }}" 
                     class="w-full h-full object-cover"
                     loading="lazy">
              {{ end }}
            {{ end }}
            
            <!-- Badge catÃ©gorie -->
            {{ with index .Params.categories 0 }}
              <div class="absolute top-4 left-4 px-3 py-1.5 bg-white/90 rounded-full shadow-sm">
                <span class="text-xs font-semibold tracking-wide uppercase" style="color: var(--primary);">
                  {{ . }}
                </span>
              </div>
            {{ end }}
          </div>
          
          <!-- Contenu premium -->
          <div class="p-6 space-y-4">
            
            <!-- Titre Ã©lÃ©gant -->
            <h3 class="font-serif text-xl leading-tight font-medium" 
                style="color: var(--color-text); font-family: 'Times New Roman', serif;">
              {{ .Title }}
            </h3>
            
            <!-- BY AUTEUR -->
            <p class="text-sm text-gray-500 mt-1">
              by {{ .Params.author | default "Chef" }}
            </p>
            
            <!-- MÃ©triques sophistiquÃ©es -->
            <div class="flex items-center justify-between pt-2 border-t border-gray-100">
              
              <!-- Temps avec logique de fallback -->
              {{ $displayTime := .Params.totalTime }}
              {{ if not $displayTime }}
                {{ if and .Params.prepTime .Params.cookTime }}
                  {{ $displayTime = printf "%s + %s" .Params.prepTime .Params.cookTime }}
                {{ else if .Params.prepTime }}
                  {{ $displayTime = .Params.prepTime }}
                {{ else if .Params.cookTime }}
                  {{ $displayTime = .Params.cookTime }}
                {{ end }}
              {{ end }}
              
              {{ with $displayTime }}
                <div class="flex items-center space-x-1.5">
                  <div class="w-4 h-4 rounded-full bg-gray-100 flex items-center justify-center">
                    <div class="w-1.5 h-1.5 rounded-full bg-gray-500"></div>
                  </div>
                  <span class="text-sm font-medium text-gray-700">
                    {{ . | replaceRE "^PT(\\d+)M$" "$1 min" | replaceRE "^PT(\\d+)H$" "$1h" | replaceRE "^PT(\\d+)H(\\d+)M$" "$1h $2min" }}
                  </span>
                </div>
              {{ end }}
              
              <!-- Portions -->
              {{ with .Params.recipeYield }}
                <div class="flex items-center space-x-1.5">
                  <div class="w-4 h-4 rounded-full bg-gray-100 flex items-center justify-center">
                    <div class="w-1.5 h-1.5 rounded-full bg-gray-500"></div>
                  </div>
                  <span class="text-sm font-medium text-gray-700">
                    {{ . }}
                  </span>
                </div>
              {{ end }}
              
              <!-- Calories -->
              {{ with .Params.nutrition.calories }}
                <div class="flex items-center space-x-1.5">
                  <div class="w-4 h-4 rounded-full bg-orange-100 flex items-center justify-center">
                    <div class="w-1.5 h-1.5 rounded-full bg-orange-500"></div>
                  </div>
                  <span class="text-sm font-medium text-gray-700">
                    {{ . }} cal
                  </span>
                </div>
              {{ end }}
            </div>
            
            <!-- Tags premium -->
            {{ if .Params.tags }}
              <div class="flex flex-wrap gap-2 pt-3">
                {{ range first 2 .Params.tags }}
                  <span class="px-2.5 py-1 bg-gray-50 rounded-full">
                    <span class="text-xs font-medium text-gray-600">{{ . }}</span>
                  </span>
                {{ end }}
              </div>
            {{ end }}
            
            <!-- Footer editorial -->
            <div class="flex justify-end pt-4 border-t border-gray-50">
              <time class="text-xs text-gray-400 font-medium" datetime="{{ .Date.Format "2006-01-02" }}">
                {{ .Date.Format "Jan 2, 2006" }}
              </time>
            </div>
          </div>
          
        </a>

      {{ end }}
    </div>
    <!-- Bouton voir toutes les recettes -->
    <div class="text-center mt-8">
      <a href="/recipes/" class="inline-flex items-center px-6 py-3 rounded-full font-semibold transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1" 
         style="background-color: var(--primary); color: white; font-family: var(--font-serif);">
        View All Recipes
        <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </a>
    </div>
  </div>
</section>

<!-- SECTION MIGRÃ‰E : Explorer par catÃ©gorie -->
<section class="section">
  <div class="container">
    
    <!-- ðŸ·ï¸ Titre avec classe section__title -->
    <h2 class="section__title">
      {{ $homepage.categories_section.title }}
    </h2>  
   
    <p class="text-base text-center mb-8 max-w-2xl mx-auto" style="color: var(--color-text-secondary);">
      Explore our curated collection of recipe categories, from comfort classics to international cuisines and dietary preferences.
    </p>
    <!-- Grille catÃ©gories avec CARDS  -->

    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 justify-center">
      {{ range first 10 (sort .Site.Taxonomies.categories "Count" "desc") }}
        {{/* ðŸŽ¯ LOGIQUE IDENTIQUE aux autres templates */}}
        {{ $slug := .Page.Title | lower | urlize }}
        {{ $displayName := .Page.Title }}
        
        {{/* Chercher dans la config s'il y a un nom personnalisÃ© */}}
        {{ $config := $.Site.Data.config }}
        {{ range $config.categories_system.categories_config.categories_list }}
          {{ if eq .slug $slug }}
            {{ $displayName = .name }}
          {{ end }}
        {{ end }}
        
        {{/* ðŸŽ¯ RÃ©cupÃ©rer la premiÃ¨re recette de cette catÃ©gorie */}}
        {{ $categoryPages := where $.Site.RegularPages "Section" "recipes" }}
        {{ $categoryPages = where $categoryPages "Params.categories" "intersect" (slice $slug) }}
        {{ if eq (len $categoryPages) 0 }}
          {{/* Essayer avec le displayName si slug ne marche pas */}}
          {{ $categoryPages = where $.Site.RegularPages "Params.categories" "intersect" (slice $displayName) }}
        {{ end }}
        {{ $firstRecipe := index $categoryPages 0 }}
        
        <!-- ðŸ† CARTE CATÃ‰GORIE PREMIUM COMPACTE -->
        <a href="{{ .Page.RelPermalink }}" class="group block bg-white overflow-hidden hover:shadow-2xl transition-all duration-500 rounded-xl transform hover:-translate-y-1">
          
          <!-- Image avec overlay -->
          <div class="relative overflow-hidden aspect-[16/9] h-32 rounded-xl">
            {{ with $firstRecipe }}
              {{ with .Params.image }}
                {{ $img := resources.Get (printf "images/%s" .) }}
                {{ if $img }}
                  {{ $resized := $img.Fill "400x225 q85" }}
                  <img src="{{ $resized.RelPermalink }}" 
                       alt="{{ $displayName }}" 
                       class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
                       loading="lazy">
                {{ else }}
                  <img src="/{{ . }}" 
                       alt="{{ $displayName }}" 
                       class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
                       loading="lazy">
                {{ end }}
              {{ end }}
            {{ else }}
              <!-- Image par dÃ©faut si pas de recette -->
              <div class="w-full h-full bg-gray-200 flex items-center justify-center rounded-xl">
                <span class="text-gray-400 text-xs">{{ $displayName }}</span>
              </div>
            {{ end }}
            
            <!-- Overlay gradient sophistiquÃ© -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent opacity-100 transition-opacity duration-500"></div>
            
            <!-- Titre de catÃ©gorie positionnÃ© en bas (animation hover) -->
            <div class="absolute bottom-0 left-0 right-0 p-3">
              <h3 class="font-serif text-sm font-bold text-white transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500" 
                  style="font-family: var(--font-serif); text-shadow: 0 2px 8px rgba(0,0,0,0.7);">
                {{ $displayName }}
              </h3>
            </div>
          </div>
          
        </a>
      {{ end }}
    </div>
    
    <!-- Bouton voir toutes les catÃ©gories -->
    <div class="text-center mt-8">
      <a href="/categories/" class="inline-flex items-center px-6 py-3 rounded-full font-semibold transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1" 
         style="background-color: var(--primary); color: white; font-family: var(--font-serif);">
        View All Categories
        <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </a>
    </div>
  </div>
</section>

<!-- SECTION MIGRÃ‰E : Recettes populaires -->
<section class="section">
  <div class="container">
    
    <!-- ðŸ·ï¸ Titre avec classe section__title -->
    <h2 class="section__title">
      {{ $homepage.popular_recipes.title }}
    </h2>
   
    <p class="text-base text-center mb-8 max-w-2xl mx-auto" style="color: var(--color-text-secondary);">
      Our community's all-time favorites - these beloved recipes have earned their place through countless successful kitchen adventures.
    </p>
    
    <!-- Grille recettes avec CARTES PREMIUM -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {{ $all := where .Site.RegularPages "Section" "recipes" }}
      {{ $count := len $all }}
      {{ if gt $count 0 }}
        {{ $week := div now.Unix 604800 }}
        {{ $offset := mod $week $count }}
        {{ $limit := 6 }}
        {{ if lt $count 6 }}{{ $limit = $count }}{{ end }}

        {{ range $i := seq 0 (sub $limit 1) }}
          {{ $idx := mod (add $offset $i) $count }}
          {{ $item := index $all $idx }}
          
          <!-- ðŸ† CARTE PREMIUM STYLÃ‰E -->
          <a href="{{ $item.RelPermalink }}" class="group block bg-white overflow-hidden hover:shadow-xl transition-shadow duration-300 rounded-lg">
            
<!-- Image optimisÃ©e -->
            <div class="relative overflow-hidden aspect-[4/3]">
              {{ with $item.Params.image }}
                {{ $img := resources.Get (printf "images/%s" .) }}
                {{ if $img }}
                  {{ $webp := $img.Fill "400x300 q50 webp" }}
                  {{ $fallback := $img.Fill "400x300 q60" }}
                  
                  <picture>
                    <source srcset="{{ $webp.RelPermalink }}" type="image/webp">
                    <img src="{{ $fallback.RelPermalink }}" 
                         alt="{{ $item.Title }}" 
                         class="w-full h-full object-cover"
                         loading="lazy"
                         width="400" 
                         height="300">
                  </picture>
                {{ else }}
                  <img src="/{{ . }}" 
                       alt="{{ $item.Title }}" 
                       class="w-full h-full object-cover"
                       loading="lazy">
                {{ end }}
              {{ end }}
              
              <!-- Badge catÃ©gorie -->
              {{ with index $item.Params.categories 0 }}
                <div class="absolute top-4 left-4 px-3 py-1.5 bg-white/90 rounded-full shadow-sm">
                  <span class="text-xs font-semibold tracking-wide uppercase" style="color: var(--primary);">
                    {{ . }}
                  </span>
                </div>
              {{ end }}
            </div>
            
            <!-- Contenu premium -->
            <div class="p-6 space-y-4">
              
              <!-- Titre Ã©lÃ©gant -->
              <h3 class="font-serif text-xl leading-tight font-medium" 
                  style="color: var(--color-text); font-family: 'Times New Roman', serif;">
                {{ $item.Title }}
              </h3>
              
              <!-- BY AUTEUR -->
              <p class="text-sm text-gray-500 mt-1">
                by {{ $item.Params.author | default "Chef" }}
              </p>
              
              <!-- MÃ©triques sophistiquÃ©es -->
              <div class="flex items-center justify-between pt-2 border-t border-gray-100">
                
                <!-- Temps avec logique de fallback -->
                {{ $displayTime := $item.Params.totalTime }}
                {{ if not $displayTime }}
                  {{ if and $item.Params.prepTime $item.Params.cookTime }}
                    {{ $displayTime = printf "%s + %s" $item.Params.prepTime $item.Params.cookTime }}
                  {{ else if $item.Params.prepTime }}
                    {{ $displayTime = $item.Params.prepTime }}
                  {{ else if $item.Params.cookTime }}
                    {{ $displayTime = $item.Params.cookTime }}
                  {{ end }}
                {{ end }}
                
                {{ with $displayTime }}
                  <div class="flex items-center space-x-1.5">
                    <div class="w-4 h-4 rounded-full bg-gray-100 flex items-center justify-center">
                      <div class="w-1.5 h-1.5 rounded-full bg-gray-500"></div>
                    </div>
                    <span class="text-sm font-medium text-gray-700">
                      {{ . | replaceRE "^PT(\\d+)M$" "$1 min" | replaceRE "^PT(\\d+)H$" "$1h" | replaceRE "^PT(\\d+)H(\\d+)M$" "$1h $2min" }}
                    </span>
                  </div>
                {{ end }}
                
                <!-- Portions -->
                {{ with $item.Params.recipeYield }}
                  <div class="flex items-center space-x-1.5">
                    <div class="w-4 h-4 rounded-full bg-gray-100 flex items-center justify-center">
                      <div class="w-1.5 h-1.5 rounded-full bg-gray-500"></div>
                    </div>
                    <span class="text-sm font-medium text-gray-700">
                      {{ . }}
                    </span>
                  </div>
                {{ end }}
                
                <!-- Calories -->
                {{ with $item.Params.nutrition.calories }}
                  <div class="flex items-center space-x-1.5">
                    <div class="w-4 h-4 rounded-full bg-orange-100 flex items-center justify-center">
                      <div class="w-1.5 h-1.5 rounded-full bg-orange-500"></div>
                    </div>
                    <span class="text-sm font-medium text-gray-700">
                      {{ . }} cal
                    </span>
                  </div>
                {{ end }}
              </div>
              
              <!-- Tags premium -->
              {{ if $item.Params.tags }}
                <div class="flex flex-wrap gap-2 pt-3">
                  {{ range first 2 $item.Params.tags }}
                    <span class="px-2.5 py-1 bg-gray-50 rounded-full">
                      <span class="text-xs font-medium text-gray-600">{{ . }}</span>
                    </span>
                  {{ end }}
                </div>
              {{ end }}
              
              <!-- Footer editorial -->
              <div class="flex justify-end pt-4 border-t border-gray-50">
                <time class="text-xs text-gray-400 font-medium" datetime="{{ $item.Date.Format "2006-01-02" }}">
                  {{ $item.Date.Format "Jan 2, 2006" }}
                </time>
              </div>
            </div>
            
          </a>
        {{ end }}
      {{ else }}
        <p class="text-center col-span-full" style="color: var(--color-text-secondary);">
          {{ $homepage.popular_recipes.empty_message }}
        </p>
      {{ end }}
    </div>
    <!-- Bouton dÃ©couvrir plus -->
    <div class="text-center mt-8">
      <a href="/recipes/" class="inline-flex items-center px-6 py-3 rounded-full font-semibold transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1" 
         style="background-color: var(--primary); color: white; font-family: var(--font-serif);">
        Discover More Recipes
        <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </a>
    </div>
  </div>
</section>

<!-- SECTION MIGRÃ‰E : Newsletter -->
<section class="section">
  <div class="container">
    
    <!-- ðŸ·ï¸ Titre avec classe section__title -->
    <h2 class="section__title">
      {{ $homepage.newsletter.title }}
    </h2>
    
    <!-- Description -->
    <p class="text-center max-w-xl mx-auto mb-8 text-base" style="color: var(--color-text-secondary);">
      {{ $homepage.newsletter.description }}
    </p>
    
    <!-- Formulaire newsletter avec BOUTON MIGRÃ‰ -->
    <form action="{{ $homepage.newsletter.form_action }}" method="POST" class="max-w-lg mx-auto flex flex-col sm:flex-row sm:items-center gap-4">
      <input type="hidden" name="_language" value="en">
      <label for="newsletter-email" class="sr-only">Adresse email</label>
      <input id="newsletter-email" type="email" name="email" required placeholder="{{ $homepage.newsletter.email_placeholder }}" class="w-full sm:flex-grow px-4 py-3 border rounded-lg focus:outline-none focus:ring-2" style="border-color: var(--color-text-muted); color: var(--color-text);">
      <!-- BOUTON NEWSLETTER MIGRÃ‰ -->
      <button type="submit" class="btn btn--primary btn--lg">
        {{ $homepage.newsletter.button_text }}
      </button>
    </form>
  </div>
</section>

{{ end }}
