{{ define "main" }}
{{ $config := .Site.Data.config }}
{{ $categories_page := $config.categories_page }}
{{ $categoriesSystem := $config.categories_system }}

<section class="container mx-auto px-4 py-24 min-h-screen" style="background-color: var(--color-bg);">
  <h2 class="font-semibold section-title mb-12 text-center" style="color: var(--primary); font-family: var(--font-serif);">
    {{ $categories_page.title }}
  </h2>
  
  <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 mb-16">
    {{ range $term := .Data.Terms.Alphabetical }}
      {{ if gt $term.Count 0 }}
        
        {{/* 🎯 Récupérer le nom personnalisé */}}
        {{ $slug := $term.Page.Title | lower | urlize }}
        {{ $displayName := $term.Page.Title }}
        
        {{/* Chercher dans la config s'il y a un nom personnalisé */}}
        {{ range $categoriesSystem.categories_config.categories_list }}
          {{ if eq .slug $slug }}
            {{ $displayName = .name }}
          {{ end }}
        {{ end }}
        
        {{/* 🎯 Récupérer la première recette de cette catégorie */}}
        {{ $categoryPages := where $.Site.RegularPages "Section" "recipes" }}
        {{ $categoryPages = where $categoryPages "Params.categories" "intersect" (slice $slug) }}
        {{ if eq (len $categoryPages) 0 }}
          {{/* Essayer avec le displayName si slug ne marche pas */}}
          {{ $categoryPages = where $.Site.RegularPages "Params.categories" "intersect" (slice $displayName) }}
        {{ end }}
        {{ $firstRecipe := index $categoryPages 0 }}
        
        <!-- 🏆 CARTE CATÉGORIE PREMIUM COMPACTE -->
        <a href="{{ $term.Page.RelPermalink }}" class="group block bg-white overflow-hidden hover:shadow-2xl transition-all duration-500 rounded-xl transform hover:-translate-y-1">
          
          <!-- Image avec overlay -->
          <div class="relative overflow-hidden aspect-[16/9] h-32 rounded-xl">
            {{ with $firstRecipe }}
              {{ with .Params.image }}
                {{ $img := resources.Get (printf "images/%s" .) }}
                {{ if $img }}
                  {{ $resized := $img.Fill "400x225 q85" }}
                  <img src="{{ $resized.RelPermalink }}" 
                       alt="{{ $displayName }}" 
                       class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
                       loading="lazy">
                {{ else }}
                  <img src="/{{ . }}" 
                       alt="{{ $displayName }}" 
                       class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
                       loading="lazy">
                {{ end }}
              {{ end }}
            {{ else }}
              <!-- Image par défaut si pas de recette -->
              <div class="w-full h-full bg-gray-200 flex items-center justify-center rounded-xl">
                <span class="text-gray-400 text-xs">{{ $displayName }}</span>
              </div>
            {{ end }}
            
            <!-- Overlay gradient sophistiqué -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent opacity-100 transition-opacity duration-500"></div>
            
            <!-- Titre de catégorie positionné en bas (toujours visible) -->
            <div class="absolute bottom-0 left-0 right-0 p-3">
              <h3 class="font-serif text-sm font-bold text-white transition-all duration-500" 
                  style="font-family: var(--font-serif); text-shadow: 0 2px 8px rgba(0,0,0,0.7);">
                {{ $displayName }}
              </h3>
            </div>
          </div>
          
          <!-- Zone de contenu épurée -->
          <div class="p-3 border border-gray-100">
            <!-- Petit indicateur subtil seulement -->
            <div class="flex justify-center">
              <div class="w-8 h-0.5 bg-gray-200 group-hover:bg-current transition-colors duration-300" style="background-color: var(--primary);"></div>
            </div>
          </div>
          
        </a>
        
      {{ end }}
    {{ end }}
  </div>
</section>
{{ end }}
